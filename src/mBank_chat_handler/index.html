
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Prompt Buddies">
      
      
      
        <link rel="prev" href="../prompt_generation/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>mBank chat handler - mBank Hacker</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mbank-chat-handler" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="mBank Hacker" class="md-header__button md-logo" aria-label="mBank Hacker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mBank Hacker
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              mBank chat handler
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mBank Hacker" class="md-nav__button md-logo" aria-label="mBank Hacker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    mBank Hacker
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SRC
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            SRC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prompt_generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompt generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    mBank chat handler
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    mBank chat handler
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.process_button_response" class="md-nav__link">
    <span class="md-ellipsis">
      process_button_response
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.process_text_response" class="md-nav__link">
    <span class="md-ellipsis">
      process_text_response
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.wait_for_new_message" class="md-nav__link">
    <span class="md-ellipsis">
      wait_for_new_message
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.process_button_response" class="md-nav__link">
    <span class="md-ellipsis">
      process_button_response
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.process_text_response" class="md-nav__link">
    <span class="md-ellipsis">
      process_text_response
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.main.wait_for_new_message" class="md-nav__link">
    <span class="md-ellipsis">
      wait_for_new_message
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="mbank-chat-handler">mBank Chat Handler</h1>


<div class="doc doc-object doc-module">



<a id="src.main"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="src.main.process_button_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_button_response</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">chat</span><span class="p">,</span> <span class="n">wolf_selector</span><span class="p">,</span> <span class="n">log_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Processes a button-based response from the chatbot and generates the next prompt.</p>
<p>This function handles chatbot responses that include interactive buttons. It extracts
the text from the buttons, logs the chatbot's response, and appends the button options
to the user's message. The function then generates the next prompt using the
<code>wolf_selector</code> and sends it to the chatbot. If an error occurs during prompt generation,
the function returns <code>False</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="playwright.sync_api.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Playwright page object used to interact with the chatbot's web interface.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chat</code>
            </td>
            <td>
                  <code><span title="src.chat_history.ChatHistory">ChatHistory</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chat history object that stores the conversation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wolf_selector</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="WolfSelector (src.wolf_selector.wolf_selector.WolfSelector)" href="../prompt_generation/#src.wolf_selector.wolf_selector.WolfSelector">WolfSelector</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object responsible for generating prompts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the log file where interaction details are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns <code>True</code> if the response was processed successfully and the next prompt
  was sent. Returns <code>False</code> if an error occurred during prompt generation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_button_response</span><span class="p">(</span>
    <span class="n">page</span><span class="p">:</span> <span class="n">Page</span><span class="p">,</span>
    <span class="n">chat</span><span class="p">:</span> <span class="n">ChatHistory</span><span class="p">,</span>
    <span class="n">wolf_selector</span><span class="p">:</span> <span class="n">WolfSelector</span><span class="p">,</span>
    <span class="n">log_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a button-based response from the chatbot and generates the next prompt.</span>

<span class="sd">    This function handles chatbot responses that include interactive buttons. It extracts</span>
<span class="sd">    the text from the buttons, logs the chatbot&#39;s response, and appends the button options</span>
<span class="sd">    to the user&#39;s message. The function then generates the next prompt using the</span>
<span class="sd">    `wolf_selector` and sends it to the chatbot. If an error occurs during prompt generation,</span>
<span class="sd">    the function returns `False`.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (Page): The Playwright page object used to interact with the chatbot&#39;s web interface.</span>
<span class="sd">        chat (ChatHistory): The chat history object that stores the conversation.</span>
<span class="sd">        wolf_selector (WolfSelector): An object responsible for generating prompts.</span>
<span class="sd">        log_path (str): The path to the log file where interaction details are saved.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Returns `True` if the response was processed successfully and the next prompt</span>
<span class="sd">              was sent. Returns `False` if an error occurred during prompt generation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chat_buttons</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span><span class="s2">&quot;chat-button&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">current_message</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span><span class="s2">&quot;#root div &gt;&gt; p.textContent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>
    <span class="n">log_response</span><span class="p">(</span><span class="n">current_message</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;bot&quot;</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">current_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chat_button</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chat_buttons</span><span class="p">):</span>
        <span class="n">slot_element</span> <span class="o">=</span> <span class="n">chat_button</span><span class="o">.</span><span class="n">evaluate_handle</span><span class="p">(</span>
            <span class="s2">&quot;e =&gt; e.shadowRoot.querySelector(&#39;slot&#39;)&quot;</span>
        <span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">slot_element</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="s2">&quot;slot =&gt; slot.assignedNodes().map(n =&gt; n.textContent).join(&#39;&#39;).trim()&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Button </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Przycisk </span><span class="si">{</span><span class="n">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">response</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Wybierz tekst z przycisków powyżej&quot;</span>
    <span class="n">chat</span><span class="o">.</span><span class="n">append_user</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="n">wolf_selector</span><span class="o">.</span><span class="n">generate_next_prompt</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="n">chat</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prompt</span> <span class="o">==</span> <span class="s2">&quot;Error: Unable to generate summary.&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">log_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
    <span class="n">send_message</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
    <span class="n">chat</span><span class="o">.</span><span class="n">append_assistant</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.main.process_text_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text_response</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">current_message</span><span class="p">,</span> <span class="n">chat</span><span class="p">,</span> <span class="n">wolf_selector</span><span class="p">,</span> <span class="n">log_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Processes a text response from the chatbot and generates the next prompt.</p>
<p>This function logs the chatbot's response, updates the chat history, and generates
the next prompt using the <code>wolf_selector</code>. It also handles specific reset conditions
based on the content of the chatbot's message. If a critical error occurs during
prompt generation, the function returns <code>False</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="playwright.sync_api.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Playwright page object used to interact with the chatbot's web interface.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current message received from the chatbot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chat</code>
            </td>
            <td>
                  <code><span title="src.chat_history.ChatHistory">ChatHistory</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The chat history object that stores the conversation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wolf_selector</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="WolfSelector (src.wolf_selector.wolf_selector.WolfSelector)" href="../prompt_generation/#src.wolf_selector.wolf_selector.WolfSelector">WolfSelector</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object responsible for generating prompts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the log file where interaction details are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns <code>True</code> if the response was processed successfully and the next prompt
  was sent. Returns <code>False</code> if an error occurred during prompt generation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_text_response</span><span class="p">(</span>
    <span class="n">page</span><span class="p">:</span> <span class="n">Page</span><span class="p">,</span>
    <span class="n">current_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">chat</span><span class="p">:</span> <span class="n">ChatHistory</span><span class="p">,</span>
    <span class="n">wolf_selector</span><span class="p">:</span> <span class="n">WolfSelector</span><span class="p">,</span>
    <span class="n">log_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a text response from the chatbot and generates the next prompt.</span>

<span class="sd">    This function logs the chatbot&#39;s response, updates the chat history, and generates</span>
<span class="sd">    the next prompt using the `wolf_selector`. It also handles specific reset conditions</span>
<span class="sd">    based on the content of the chatbot&#39;s message. If a critical error occurs during</span>
<span class="sd">    prompt generation, the function returns `False`.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (Page): The Playwright page object used to interact with the chatbot&#39;s web interface.</span>
<span class="sd">        current_message (str): The current message received from the chatbot.</span>
<span class="sd">        chat (ChatHistory): The chat history object that stores the conversation.</span>
<span class="sd">        wolf_selector (WolfSelector): An object responsible for generating prompts.</span>
<span class="sd">        log_path (str): The path to the log file where interaction details are saved.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Returns `True` if the response was processed successfully and the next prompt</span>
<span class="sd">              was sent. Returns `False` if an error occurred during prompt generation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log_response</span><span class="p">(</span><span class="n">current_message</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;bot&quot;</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">current_message</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">chat</span><span class="o">.</span><span class="n">append_user</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bot message: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">prompt</span> <span class="o">=</span> <span class="n">wolf_selector</span><span class="o">.</span><span class="n">generate_next_prompt</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="n">chat</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prompt</span> <span class="o">==</span> <span class="s2">&quot;Error: Unable to generate summary.&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">warning</span> <span class="ow">in</span> <span class="n">current_message</span>
        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Jesteś zablokowany!!!&quot;</span><span class="p">,</span> <span class="s2">&quot;Komunikat na potrzeby hackatonu:&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Bot triggered reset condition&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">execv</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

    <span class="n">log_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
    <span class="n">send_message</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
    <span class="n">chat</span><span class="o">.</span><span class="n">append_assistant</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.main.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">playwright</span><span class="p">,</span> <span class="n">wolf_selector</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">log_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Runs the chatbot interaction session using Playwright.</p>
<p>This function initializes a browser session, logs into the mBank system,
and manages the interaction with the chatbot. It continuously listens for
chatbot responses, processes them, and sends appropriate replies based on
the response type (text or buttons). The session runs in a loop until
interrupted or an error occurs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>playwright</code>
            </td>
            <td>
                  <code><span title="playwright.sync_api.Playwright">Playwright</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Playwright instance used to control the browser.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wolf_selector</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="WolfSelector (src.wolf_selector.wolf_selector.WolfSelector)" href="../prompt_generation/#src.wolf_selector.wolf_selector.WolfSelector">WolfSelector</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object responsible for generating prompts
                          and handling chatbot interactions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>login</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The login credential for accessing the mBank system.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>password</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The password credential for accessing the mBank system.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the log file where interaction details are saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This function does not return any value. It runs until interrupted
  or an error occurs, at which point it shuts down the browser session.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="n">playwright</span><span class="p">:</span> <span class="n">Playwright</span><span class="p">,</span>
    <span class="n">wolf_selector</span><span class="p">:</span> <span class="n">WolfSelector</span><span class="p">,</span>
    <span class="n">login</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">log_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs the chatbot interaction session using Playwright.</span>

<span class="sd">    This function initializes a browser session, logs into the mBank system,</span>
<span class="sd">    and manages the interaction with the chatbot. It continuously listens for</span>
<span class="sd">    chatbot responses, processes them, and sends appropriate replies based on</span>
<span class="sd">    the response type (text or buttons). The session runs in a loop until</span>
<span class="sd">    interrupted or an error occurs.</span>

<span class="sd">    Args:</span>
<span class="sd">        playwright (Playwright): The Playwright instance used to control the browser.</span>
<span class="sd">        wolf_selector (WolfSelector): An object responsible for generating prompts</span>
<span class="sd">                                      and handling chatbot interactions.</span>
<span class="sd">        login (str): The login credential for accessing the mBank system.</span>
<span class="sd">        password (str): The password credential for accessing the mBank system.</span>
<span class="sd">        log_path (str): The path to the log file where interaction details are saved.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: This function does not return any value. It runs until interrupted</span>
<span class="sd">              or an error occurs, at which point it shuts down the browser session.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">browser</span> <span class="o">=</span> <span class="n">playwright</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_context</span><span class="p">()</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">preprae_page</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">login</span><span class="o">=</span><span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>

    <span class="n">chat</span> <span class="o">=</span> <span class="n">ChatHistory</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting chatbot session&quot;</span><span class="p">)</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">wolf_selector</span><span class="o">.</span><span class="n">good_prompt_generator</span><span class="o">.</span><span class="n">generate_first_prompt</span><span class="p">()</span>
    <span class="n">chat</span><span class="o">.</span><span class="n">append_assistant</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="n">send_message</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
    <span class="n">log_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial prompt: </span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">messages_container_locator</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span>
        <span class="s2">&quot;#root div &gt;&gt; mbank-chat-messages-container &gt;&gt; #scrollable-container div&quot;</span>
    <span class="p">)</span>
    <span class="n">current_message</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span><span class="s2">&quot;#root div &gt;&gt; p.textContent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>
    <span class="n">last_message</span> <span class="o">=</span> <span class="n">current_message</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">messages_container_locator</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span>
                <span class="s2">&quot;#root div &gt;&gt; mbank-chat-messages-container &gt;&gt; #scrollable-container div&quot;</span>
            <span class="p">)</span>
            <span class="n">current_message</span> <span class="o">=</span> <span class="n">wait_for_new_message</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">last_message</span><span class="p">)</span>
            <span class="n">current_response_type</span> <span class="o">=</span> <span class="n">get_current_response_type</span><span class="p">(</span>
                <span class="n">messages_container_locator</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current response type: </span><span class="si">{</span><span class="n">current_response_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">current_response_type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">MESSAGE</span><span class="p">,</span> <span class="n">ResponseType</span><span class="o">.</span><span class="n">RESET</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">process_text_response</span><span class="p">(</span>
                    <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                    <span class="n">current_message</span><span class="o">=</span><span class="n">current_message</span><span class="p">,</span>
                    <span class="n">chat</span><span class="o">=</span><span class="n">chat</span><span class="p">,</span>
                    <span class="n">wolf_selector</span><span class="o">=</span><span class="n">wolf_selector</span><span class="p">,</span>
                    <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">current_response_type</span> <span class="o">==</span> <span class="n">ResponseType</span><span class="o">.</span><span class="n">BUTTONS</span><span class="p">:</span>
                <span class="n">buttons</span> <span class="o">=</span> <span class="n">messages_container_locator</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span><span class="s2">&quot;chat-button&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                <span class="n">confirm_button_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">button</span><span class="o">.</span><span class="n">id</span>
                        <span class="k">for</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">buttons</span>
                        <span class="k">if</span> <span class="n">button</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Potwierdź&quot;</span>
                    <span class="p">),</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">confirm_button_id</span><span class="p">:</span>
                    <span class="n">chosen_button</span> <span class="o">=</span> <span class="n">buttons</span><span class="p">[</span><span class="n">confirm_button_id</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chosen_button</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
                <span class="n">chosen_button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="n">chosen_button</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>
                <span class="n">log_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">log_path</span><span class="o">=</span><span class="n">log_path</span><span class="p">)</span>
                <span class="n">chat</span><span class="o">.</span><span class="n">append_assistant</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for response...&quot;</span><span class="p">)</span>

            <span class="n">last_message</span> <span class="o">=</span> <span class="n">current_message</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exiting...&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">execv</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Shutting down browser and context&quot;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">browser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.main.wait_for_new_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wait_for_new_message</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">last_message</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Waits for a new message from the chatbot.</p>
<p>This function continuously checks for a new message from the chatbot by comparing
the current message with the last received message. It pauses for 1 second between
checks to avoid excessive polling. Once a new message is detected, it is returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="playwright.sync_api.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Playwright page object used to interact with the chatbot's web interface.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>last_message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The last message received from the chatbot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new message received from the chatbot.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wait_for_new_message</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">Page</span><span class="p">,</span> <span class="n">last_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Waits for a new message from the chatbot.</span>

<span class="sd">    This function continuously checks for a new message from the chatbot by comparing</span>
<span class="sd">    the current message with the last received message. It pauses for 1 second between</span>
<span class="sd">    checks to avoid excessive polling. Once a new message is detected, it is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (Page): The Playwright page object used to interact with the chatbot&#39;s web interface.</span>
<span class="sd">        last_message (str): The last message received from the chatbot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The new message received from the chatbot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_message</span> <span class="o">=</span> <span class="n">last_message</span>
    <span class="k">while</span> <span class="n">current_message</span> <span class="o">==</span> <span class="n">last_message</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">current_message</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">locator</span><span class="p">(</span><span class="s2">&quot;#root div &gt;&gt; p.textContent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">inner_text</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Waiting for new message from chatbot...&quot;</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">current_message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>